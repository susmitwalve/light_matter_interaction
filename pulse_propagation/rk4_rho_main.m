function resmat=rk4_rho_main(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,dt,g1old,g1new,g2old,g2new)
rho11_0=rho11;
rho12_0=rho12;
rho13_0=rho13;
rho14_0=rho14;
rho22_0=rho22;
rho23_0=rho23;
rho24_0=rho24;
rho33_0=rho33;
rho34_0=rho34;
g1=g1old;
g2=g2old;

K_1=dt*f11(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
L_1=dt*f12(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
M_1=dt*f13(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
N_1=dt*f14(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
O_1=dt*f22(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
P_1=dt*f23(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
Q_1=dt*f24(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
R_1=dt*f33(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
S_1=dt*f34(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);

rho11=rho11_0+K_1/2;
rho12=rho12_0+L_1/2;
rho13=rho13_0+M_1/2;
rho14=rho14_0+N_1/2;
rho22=rho22_0+O_1/2;
rho23=rho23_0+P_1/2;
rho24=rho24_0+Q_1/2;
rho33=rho33_0+R_1/2;
rho34=rho34_0+S_1/2;
g1=(g1old+g1new)/2;
g2=(g2old+g2new)/2;

K_2=dt*f11(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
L_2=dt*f12(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
M_2=dt*f13(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
N_2=dt*f14(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
O_2=dt*f22(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
P_2=dt*f23(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
Q_2=dt*f24(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
R_2=dt*f33(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
S_2=dt*f34(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);

rho11=rho11_0+K_2/2;
rho12=rho12_0+L_2/2;
rho13=rho13_0+M_2/2;
rho14=rho14_0+N_2/2;
rho22=rho22_0+O_2/2;
rho23=rho23_0+P_2/2;
rho24=rho24_0+Q_2/2;
rho33=rho33_0+R_2/2;
rho34=rho34_0+S_2/2;
g1=(g1old+g1new)/2;
g2=(g2old+g2new)/2;

K_3=dt*f11(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
L_3=dt*f12(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
M_3=dt*f13(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
N_3=dt*f14(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
O_3=dt*f22(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
P_3=dt*f23(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
Q_3=dt*f24(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
R_3=dt*f33(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
S_3=dt*f34(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);

rho11=rho11_0+K_3;
rho12=rho12_0+L_3;
rho13=rho13_0+M_3;
rho14=rho14_0+N_3;
rho22=rho22_0+O_3;
rho23=rho23_0+P_3;
rho24=rho24_0+Q_3;
rho33=rho33_0+R_3;
rho34=rho34_0+S_3;
g1=g1new;
g2=g2new;

K_4=dt*f11(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
L_4=dt*f12(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
M_4=dt*f13(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
N_4=dt*f14(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
O_4=dt*f22(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
P_4=dt*f23(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
Q_4=dt*f24(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
R_4=dt*f33(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);
S_4=dt*f34(rho11,rho12,rho13,rho14,rho22,rho23,rho24,rho33,rho34,g1,g2);

rho11=K_1/6+K_2/3+K_3/3+K_4/6;
rho12=L_1/6+L_2/3+L_3/3+L_4/6;
rho13=M_1/6+M_2/3+M_3/3+M_4/6;
rho14=N_1/6+N_2/3+N_3/3+N_4/6;
rho22=O_1/6+O_2/3+O_3/3+O_4/6;
rho23=P_1/6+P_2/3+P_3/3+P_4/6;
rho24=Q_1/6+Q_2/3+Q_3/3+Q_4/6;
rho33=R_1/6+R_2/3+R_3/3+R_4/6;
rho34=S_1/6+S_2/3+S_3/3+S_4/6;

resmat=rho11;
resmat(:,:,2)=rho12;
resmat(:,:,3)=rho13;
resmat(:,:,4)=rho14;
resmat(:,:,5)=rho22;
resmat(:,:,6)=rho23;
resmat(:,:,7)=rho24;
resmat(:,:,8)=rho33;
resmat(:,:,9)=rho34;
end